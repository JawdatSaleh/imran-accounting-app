<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø­Ø³Ø§Ø¨Ø§Øª</title>
  <style>
    body { font-family: "Cairo", sans-serif; background: #f4f6f8; margin: 0; padding: 20px; color: #222; }
    h1 { text-align: center; color: #333; }
    .login-box, #app { max-width: 700px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #0077cc; color: white; }
    input, select, button { padding: 8px; margin: 5px; }
    .totals { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
    .stat { background: #eee; border-radius: 8px; padding: 10px; flex: 1; min-width: 120px; text-align: center; }
    .value { font-weight: bold; font-size: 1.2em; color: #0077cc; }
  </style>
</head>
<body>

  <h1>ğŸ“Š ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</h1>

  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginScreen" class="login-box">
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
    <select id="usernameSelect">
      <option value="A1">A1</option>
      <option value="A2">A2</option>
    </select><br>
    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
    <input type="password" id="passwordInput"><br>
    <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app" style="display:none;">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ©</h3>
    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
    <input type="date" id="entryDate"><br>
    <label>Ø§Ù„Ù†ÙˆØ¹:</label>
    <select id="entryType">
      <option value="expense">Ù…ØµØ±ÙˆÙ</option>
      <option value="income">Ø¥ÙŠØ±Ø§Ø¯</option>
      <option value="transfer">ØªØ­ÙˆÙŠÙ„</option>
    </select><br>
    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
    <input type="number" id="entryAmount" step="0.01"><br>
    <label>Ø§Ù„ÙØ¦Ø©:</label>
    <select id="entryCategory"></select><br>
    <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label>
    <select id="entryLocation">
      <option value="cash">Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</option>
      <option value="bank">Ø§Ù„Ø¨Ù†Ùƒ</option>
    </select><br>
    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
    <input type="text" id="entryNotes"><br>
    <button onclick="submitEntry()">â• Ø¥Ø¶Ø§ÙØ©</button>

    <h3>ğŸ“„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</h3>
    <table>
      <thead>
        <tr>
          <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <th>Ø§Ù„Ù†ÙˆØ¹</th>
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <th>Ø§Ù„ÙØ¦Ø©</th>
          <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
          <th>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
          <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
          <th>Ø­Ø°Ù</th>
        </tr>
      </thead>
      <tbody id="entriesBody"></tbody>
    </table>

    <div class="totals">
      <div class="stat"><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</strong><div class="value" id="totalExpenses">0</div></div>
      <div class="stat"><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</strong><div class="value" id="totalIncome">0</div></div>
      <div class="stat"><strong>Ø±ØµÙŠØ¯ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</strong><div class="value" id="cashBalance">0</div></div>
      <div class="stat"><strong>Ø±ØµÙŠØ¯ Ø§Ù„Ø¨Ù†Ùƒ</strong><div class="value" id="bankBalance">0</div></div>
    </div>

    <h3>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ¦Ø§Øª</h3>
    <div id="categoryTotals" class="totals"></div>
  </div>

<script>
const users = { A1: '1234', A2: '5678' };
const categories = ['Ø¹Ù‡Ø¯ Ù…Ø³Ø¬Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©','Ù…ØµØ§Ø±ÙŠÙ A1','Ù…ØµØ§Ø±ÙŠÙ A2','Ù…ØµØ§Ø±ÙŠÙ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©','Ø¯ÙŠÙˆÙ†'];
let currentUser = null;
let entries = [];

// âœ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø±Ø§Ø¨Ø· Google Apps Script
const remoteConfig = {
  type: 'gSheet',
  gSheet: {
    url: 'https://script.google.com/macros/s/AKfycbz3UCd43zN9INdUYh4wQ8xxAMGy4ltaX2I2a24tdGeMOk5i2k6kmoIQXUmPaLnVlScK/exec'
  }
};

// âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
async function loadEntries() {
  try {
    const resp = await fetch(remoteConfig.gSheet.url, { method: 'GET', mode: 'cors' });
    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
    const data = await resp.json();
    entries = data.map(item => ({
      id: item.id, date: item.date, type: item.type, amount: Number(item.amount),
      category: item.category, location: item.location, notes: item.notes || '', user: item.user || ''
    }));
    updateUI();
  } catch (err) {
    console.error('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err);
    alert('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets');
  }
}

// âœ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets
async function saveEntries() {
  try {
    const response = await fetch(remoteConfig.gSheet.url, {
      method: 'POST',
      mode: 'cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ entries })
    });
    if (!response.ok) throw new Error(`ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ${response.status}`);
    alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Google Sheets');
  } catch (err) {
    console.error('âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', err);
    alert('âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheets');
  }
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login() {
  const user = document.getElementById('usernameSelect').value;
  const pass = document.getElementById('passwordInput').value;
  if (users[user] && users[user] === pass) {
    currentUser = user;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('app').style.display = 'block';
    document.getElementById('entryDate').valueAsDate = new Date();
    loadEntries();
  } else {
    alert('âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
  }
}

// ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙØ¦Ø§Øª
const categorySelect = document.getElementById('entryCategory');
categories.forEach(cat => {
  const opt = document.createElement('option');
  opt.value = cat;
  opt.textContent = cat;
  categorySelect.appendChild(opt);
});

// Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
function submitEntry() {
  if (!currentUser) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
  const date = document.getElementById('entryDate').value;
  const type = document.getElementById('entryType').value;
  const amount = parseFloat(document.getElementById('entryAmount').value);
  const category = document.getElementById('entryCategory').value;
  const location = document.getElementById('entryLocation').value;
  const notes = document.getElementById('entryNotes').value;

  if (!date || isNaN(amount) || !category || !location) return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');

  const entry = { id: Date.now(), date, type, amount, category, location, notes, user: currentUser };
  entries.push(entry);
  clearEntryForm(); updateUI(); saveEntries();
}

function clearEntryForm() {
  document.getElementById('entryAmount').value = '';
  document.getElementById('entryNotes').value = '';
}

// Ø­Ø°Ù Ø³Ø¬Ù„
function deleteEntry(id) {
  entries = entries.filter(e => e.id !== id);
  updateUI(); saveEntries();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
function updateUI() { renderEntries(); updateTotals(); }

function renderEntries() {
  const tbody = document.getElementById('entriesBody');
  tbody.innerHTML = '';
  entries.forEach(entry => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${entry.id}</td>
      <td>${entry.date}</td>
      <td>${translateType(entry.type)}</td>
      <td>${entry.amount.toFixed(2)} Ø±.Ø³</td>
      <td>${entry.category}</td>
      <td>${translateLocation(entry.location)}</td>
      <td>${entry.user}</td>
      <td>${entry.notes}</td>
      <td><button onclick="deleteEntry(${entry.id})">ğŸ—‘ï¸</button></td>`;
    tbody.appendChild(tr);
  });
}

function translateType(t) {
  switch (t) {
    case 'expense': return 'Ù…ØµØ±ÙˆÙ';
    case 'income': return 'Ø¥ÙŠØ±Ø§Ø¯';
    case 'transfer': return 'ØªØ­ÙˆÙŠÙ„';
    default: return t;
  }
}
function translateLocation(l) { return l === 'cash' ? 'Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚' : 'Ø§Ù„Ø¨Ù†Ùƒ'; }

function updateTotals() {
  let totalExpenses = 0, totalIncome = 0, cash = 0, bank = 0;
  const catTotals = {}; categories.forEach(c => catTotals[c] = 0);
  entries.forEach(e => {
    if (e.type === 'expense') {
      totalExpenses += e.amount; e.location === 'cash' ? cash -= e.amount : bank -= e.amount;
      if (catTotals[e.category] !== undefined) catTotals[e.category] += e.amount;
    } else if (e.type === 'income') {
      totalIncome += e.amount; e.location === 'cash' ? cash += e.amount : bank += e.amount;
    } else if (e.type === 'transfer') {
      if (e.location === 'cash') { cash -= e.amount; bank += e.amount; } else { bank -= e.amount; cash += e.amount; }
    }
  });
  document.getElementById('totalExpenses').textContent = totalExpenses.toFixed(2);
  document.getElementById('totalIncome').textContent = totalIncome.toFixed(2);
  document.getElementById('cashBalance').textContent = cash.toFixed(2);
  document.getElementById('bankBalance').textContent = bank.toFixed(2);
  const catContainer = document.getElementById('categoryTotals');
  catContainer.innerHTML = '';
  categories.forEach(cat => {
    const div = document.createElement('div');
    div.className = 'stat';
    div.innerHTML = `<strong>${cat}</strong><div class="value">${catTotals[cat].toFixed(2)}</div>`;
    catContainer.appendChild(div);
  });
}
</script>

</body>
</html>
